<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Enhancer | EREX-TECHNOLOGIES</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#0d1b2a;color:#fff;font-family:Arial,sans-serif;overflow:hidden;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;}

.camera-container{position:relative;width:100%;max-width:640px;height:80vh;background:#000;border-radius:15px;overflow:hidden;box-shadow:0 0 20px #00b4d8;}

video{width:100%;height:100%;object-fit:cover;transform-origin:center center;}

.aspect-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);border:2px dashed rgba(255,255,255,0.5);pointer-events:none;}

.controls{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:10px;align-items:center;justify-content:center;background:rgba(0,0,0,0.3);padding:10px;border-radius:10px;flex-wrap:wrap;}

.controls button{background:#00b4d8;border:none;padding:10px 15px;border-radius:50%;cursor:pointer;font-weight:bold;transition:0.3s;}
.controls button:hover{background:#0096c7;}
.controls label{display:flex;flex-direction:column;font-size:0.75rem;text-align:center;color:#fff;}
.controls input, .controls select{margin-top:3px;}
</style>
</head>
<body>

<div class="camera-container">
  <video id="video" autoplay playsinline muted></video>
  <div class="aspect-overlay" id="aspectOverlay"></div>

  <div class="controls">
    <button id="toggleCamera">üîÑ</button>
    <button id="start">‚è∫</button>
    <button id="stop" disabled>‚èπ</button>
    <label>Zoom<input type="range" id="zoom" min="1" max="3" step="0.01" value="1"></label>
    <label>Brightness<input type="range" id="brightness" min="50" max="150" value="100"></label>
    <label>Contrast<input type="range" id="contrast" min="50" max="150" value="100"></label>
    <label>Saturation<input type="range" id="saturation" min="0" max="200" value="100"></label>
    <label>Aspect<select id="aspect"><option value="1">1:1</option><option value="4/3">4:3</option><option value="16/9" selected>16:9</option></select></label>
  </div>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
const video=document.getElementById('video');
const canvas=document.getElementById('canvas');
const brightness=document.getElementById('brightness');
const contrast=document.getElementById('contrast');
const saturation=document.getElementById('saturation');
const zoom=document.getElementById('zoom');
const aspect=document.getElementById('aspect');
const toggleCamera=document.getElementById('toggleCamera');
const startBtn=document.getElementById('start');
const stopBtn=document.getElementById('stop');
const aspectOverlay=document.getElementById('aspectOverlay');

let currentStream,useFrontCamera=true,mediaRecorder,recordedChunks=[],recording=false;

// Start camera
async function startCamera(){
  if(currentStream)currentStream.getTracks().forEach(t=>t.stop());
  const constraints={video:{facingMode:useFrontCamera?'user':'environment'},audio:true};
  try{currentStream=await navigator.mediaDevices.getUserMedia(constraints);video.srcObject=currentStream;}catch(err){alert('Camera access denied: '+err);}
}

// Update filters
function updateFilters(){
  video.style.filter=`brightness(${brightness.value}%) contrast(${contrast.value}%) saturate(${saturation.value}%)`;
  video.style.transform=`scale(${zoom.value})`;
}
[brightness,contrast,saturation,zoom].forEach(el=>el.addEventListener('input',updateFilters));

// Toggle camera
toggleCamera.addEventListener('click',()=>{useFrontCamera=!useFrontCamera;startCamera();});

// Start recording
startBtn.addEventListener('click',()=>{
  recordedChunks=[];
  const stream=canvas.captureStream(30); // 30fps
  mediaRecorder=new MediaRecorder(stream,{mimeType:'video/webm'}); 
  mediaRecorder.ondataavailable=e=>{if(e.data.size>0)recordedChunks.push(e.data)};
  mediaRecorder.onstop=()=>{
    const blob=new Blob(recordedChunks,{type:'video/webm'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;
    a.download='video.webm';
    a.click();
  };
  mediaRecorder.start();
  recording=true;
  startBtn.disabled=true;
  stopBtn.disabled=false;
  drawCanvasLoop();
});

// Stop recording
stopBtn.addEventListener('click',()=>{
  mediaRecorder.stop();
  recording=false;
  startBtn.disabled=false;
  stopBtn.disabled=true;
});

// Draw video with filters and aspect ratio
function drawCanvasLoop(){
  if(!recording) return;
  const ar=eval(aspect.value);
  const vw=video.videoWidth;
  const vh=video.videoHeight;
  canvas.width=vw;
  canvas.height=vw/ar;
  const ctx=canvas.getContext('2d');
  ctx.filter=video.style.filter;

  let sx=0,sy=0,sw=vw,sh=vh;
  if(vw/vh>ar){sw=vh*ar;sx=(vw-sw)/2;}else{sh=vw/ar;sy=(vh-sh)/2;}
  ctx.drawImage(video,sx,sy,sw,sh,0,0,canvas.width,canvas.height);

  requestAnimationFrame(drawCanvasLoop);
}

// Aspect overlay
function updateAspectOverlay(){
  const container=document.querySelector('.camera-container');
  const rect=container.getBoundingClientRect();
  const ar=eval(aspect.value);
  let overlayWidth,overlayHeight;
  if(rect.width/rect.height>ar){overlayHeight=rect.height*0.9;overlayWidth=overlayHeight*ar;}
  else{overlayWidth=rect.width*0.9;overlayHeight=overlayWidth/ar;}
  aspectOverlay.style.width=overlayWidth+'px';
  aspectOverlay.style.height=overlayHeight+'px';
}
aspect.addEventListener('change',updateAspectOverlay);
window.addEventListener('resize',updateAspectOverlay);

startCamera();
updateAspectOverlay();
</script>
</body>
</html>
